<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reseller Dashboard - Happy OTP</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  
  <style>
    :root {
      --primary-green: #00ff99;
      --dark-green: #008b45;
      --bg-dark: #0a0a0a;
      --bg-light: #121212;
      --bg-lighter: #1a1a1a;
      --border-color: #004d26;
      --text-glow: 0 0 8px #00ff99, 0 0 12px #00ff99;
    }

    * {
      box-sizing: border-box;
    }

    body {
      background-color: var(--bg-dark);
      color: #e5e7eb;
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
    }

    .header-container {
      background: linear-gradient(to right, #0a0a0a, #004d26, #0a0a0a);
      border-bottom: 2px solid var(--primary-green);
      box-shadow: 0 0 20px rgba(0, 255, 153, 0.2);
    }

    .whatsapp-icon {
      color: var(--primary-green);
      font-size: 2.5rem;
      filter: drop-shadow(0 0 10px var(--primary-green));
      animation: pulse-icon 2s infinite;
    }

    @keyframes pulse-icon {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .premium-title {
      font-weight: 900;
      letter-spacing: 1px;
      color: var(--primary-green);
      text-shadow: var(--text-glow);
      animation: pulse-glow 4s ease-in-out infinite;
    }

    @keyframes pulse-glow {
      0%, 100% { text-shadow: var(--text-glow); }
      50% { text-shadow: 0 0 15px #00ff99, 0 0 20px #00ff99; }
    }

    .balance-display {
      background: rgba(0, 77, 38, 0.3);
      border: 1px solid var(--primary-green);
      border-radius: 10px;
      padding: 8px 15px;
      box-shadow: 0 0 10px rgba(0, 255, 153, 0.3);
    }

    .balance-amount {
      color: var(--primary-green);
      font-weight: bold;
      font-size: 1.1rem;
    }

    .number-card {
      background: var(--bg-light);
      border: 2px solid var(--border-color);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.3);
    }

    .action-btn {
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: bold;
      border: none;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .copy-btn {
      background: linear-gradient(to right, var(--primary-green), var(--dark-green));
      color: black;
    }

    .share-btn {
      background: linear-gradient(to right, #25D366, #128C7E);
      color: white;
    }

    .telegram-btn {
      background: linear-gradient(to right, #0088cc, #006699);
      color: white;
    }

    .withdraw-btn {
      background: linear-gradient(to right, #FFD166, #F9A825);
      color: black;
    }

    .stat-card {
      background: rgba(0, 255, 153, 0.05);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      padding: 15px;
      text-align: center;
    }

    .referral-link-box {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      padding: 15px;
      margin: 10px 0;
    }

    .table-header {
      background: rgba(0, 77, 38, 0.5);
      border-bottom: 2px solid var(--primary-green);
    }

    .table-row {
      border-bottom: 1px solid rgba(255,255,255,0.1);
      transition: all 0.3s;
    }

    .table-row:hover {
      background: rgba(0, 255, 153, 0.05);
    }

    .modal-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10000;
    }

    .modal-backdrop.show {
      display: flex !important;
    }

    .modal-content {
      background: var(--bg-dark);
      border: 2px solid var(--primary-green);
      border-radius: 12px;
      padding: 25px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 0 30px rgba(0, 255, 153, 0.3);
    }

    .profile-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: var(--bg-dark);
      border: 2px solid var(--primary-green);
      border-radius: 10px;
      padding: 20px;
      width: 280px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      display: none;
      z-index: 100;
    }

    .profile-dropdown.show {
      display: block;
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .qr-code {
      background: white;
      padding: 20px;
      border-radius: 10px;
      display: inline-block;
      margin: 20px 0;
    }

    @media (max-width: 768px) {
      .premium-title {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body class="p-4">
  
  <!-- Auth Modal -->
  <div id="authModal" class="modal-backdrop" style="display: flex;">
    <div class="modal-content">
      <div class="text-center mb-6">
        <i class="fas fa-user-tie text-5xl mb-4" style="color: var(--primary-green);"></i>
        <h2 class="text-2xl font-bold" style="color: var(--primary-green);">RESELLER LOGIN</h2>
        <p class="text-gray-400 mt-2">Login to access reseller dashboard</p>
      </div>
      
      <div id="loginFields">
        <input type="email" id="loginEmail" class="w-full p-3 mb-3 bg-bg-light border border-border-color text-white rounded-lg" placeholder="Email Address">
        <input type="password" id="loginPassword" class="w-full p-3 mb-4 bg-bg-light border border-border-color text-white rounded-lg" placeholder="Password">
        
        <button id="authLoginBtn" class="w-full p-3 mb-3" style="background: linear-gradient(to right, var(--primary-green), var(--dark-green)); color: black; border-radius: 8px; font-weight: bold;">
          <i class="fas fa-sign-in-alt mr-2"></i>
          LOGIN
        </button>
        
        <div class="text-center mt-4">
          <p class="text-gray-400">
            Don't have an account? 
            <a href="/" class="text-primary-green font-bold">
              Register First
            </a>
          </p>
          <p class="text-gray-400 text-sm mt-2">
            Not a reseller? 
            <a href="/" class="text-yellow-400">
              Go to User Dashboard
            </a>
          </p>
        </div>
      </div>
      
      <div id="authStatus" class="mt-4 p-3 rounded-lg hidden"></div>
    </div>
  </div>

  <!-- Become Reseller Modal -->
  <div id="becomeResellerModal" class="modal-backdrop">
    <div class="modal-content">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-bold" style="color: var(--primary-green);">
          <i class="fas fa-user-tie mr-2"></i>
          BECOME A RESELLER
        </h3>
        <button onclick="closeBecomeResellerModal()" class="text-gray-400 hover:text-white">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      
      <div class="space-y-4">
        <div>
          <label class="block text-gray-300 mb-2">Your Name</label>
          <input type="text" id="resellerName" class="w-full p-3 bg-bg-light border border-border-color rounded-lg text-white" 
            placeholder="Enter your name for reseller account">
        </div>
        
        <div>
          <label class="block text-gray-300 mb-2">Commission Rate</label>
          <select id="commissionRate" class="w-full p-3 bg-bg-light border border-border-color rounded-lg text-white">
            <option value="5">5% Commission (Lowest Price)</option>
            <option value="10" selected>10% Commission (Recommended)</option>
            <option value="15">15% Commission</option>
            <option value="20">20% Commission</option>
            <option value="25">25% Commission</option>
            <option value="30">30% Commission (Maximum)</option>
          </select>
          <p class="text-sm text-gray-400 mt-2">Higher commission = Higher price for your customers</p>
        </div>
        
        <div class="p-3 bg-yellow-900 bg-opacity-20 border border-yellow-700 rounded-lg">
          <i class="fas fa-exclamation-triangle text-yellow-500 mr-2"></i>
          <span class="text-yellow-300 text-sm">Commission rate cannot be changed later. Choose carefully!</span>
        </div>
        
        <button onclick="registerAsReseller()" class="w-full p-3" style="background: linear-gradient(to right, var(--primary-green), var(--dark-green)); color: black; border-radius: 8px; font-weight: bold;">
          <i class="fas fa-user-tie mr-2"></i>
          BECOME RESELLER
        </button>
      </div>
    </div>
  </div>

  <!-- Withdraw Modal -->
  <div id="withdrawModal" class="modal-backdrop">
    <div class="modal-content">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-bold" style="color: var(--primary-green);">
          <i class="fas fa-money-bill-wave mr-2"></i>
          WITHDRAW EARNINGS
        </h3>
        <button onclick="closeWithdrawModal()" class="text-gray-400 hover:text-white">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      
      <div class="space-y-4">
        <div class="p-3 bg-blue-900 bg-opacity-20 border border-blue-700 rounded-lg">
          <i class="fas fa-info-circle text-blue-500 mr-2"></i>
          <span class="text-blue-300">Current Balance: <span id="withdrawBalance" class="font-bold">₹0</span></span>
        </div>
        
        <div>
          <label class="block text-gray-300 mb-2">Withdrawal Amount (₹)</label>
          <input type="number" id="withdrawAmount" class="w-full p-3 bg-bg-light border border-border-color rounded-lg text-white" 
            placeholder="Enter amount to withdraw">
        </div>
        
        <div>
          <label class="block text-gray-300 mb-2">Payment Method</label>
          <select id="paymentMethod" class="w-full p-3 bg-bg-light border border-border-color rounded-lg text-white">
            <option value="upi">UPI Payment</option>
            <option value="bank">Bank Transfer</option>
            <option value="paytm">PayTM</option>
            <option value="phonepe">PhonePe</option>
          </select>
        </div>
        
        <div>
          <label class="block text-gray-300 mb-2">UPI ID / Account Details</label>
          <input type="text" id="paymentDetails" class="w-full p-3 bg-bg-light border border-border-color rounded-lg text-white" 
            placeholder="Enter UPI ID or Account Number">
        </div>
        
        <div class="p-3 bg-gray-800 rounded-lg">
          <p class="text-sm text-gray-400">
            <i class="fas fa-clock mr-2"></i>
            Withdrawals are processed within 24 hours
          </p>
          <p class="text-sm text-gray-400 mt-1">
            <i class="fas fa-percentage mr-2"></i>
            Minimum withdrawal: ₹100
          </p>
        </div>
        
        <button onclick="submitWithdrawal()" class="w-full p-3" style="background: linear-gradient(to right, #FFD166, #F9A825); color: black; border-radius: 8px; font-weight: bold;">
          <i class="fas fa-paper-plane mr-2"></i>
          SUBMIT WITHDRAWAL REQUEST
        </button>
      </div>
    </div>
  </div>

  <!-- Main Container -->
  <div class="max-w-7xl mx-auto space-y-6">
    
    <!-- HEADER -->
    <header class="header-container p-4 rounded-xl">
      <div class="flex justify-between items-center">
        <!-- Left: Logo & Title -->
        <div class="flex items-center gap-3">
          <i class="fab fa-whatsapp whatsapp-icon"></i>
          <div>
            <h1 class="premium-title text-2xl sm:text-3xl">HAPPY OTP RESELLER</h1>
            <p class="text-gray-400 text-sm">Earn Commission by Referring Customers</p>
          </div>
        </div>
        
        <!-- Right: Balance & Profile -->
        <div class="flex items-center gap-4">
          <!-- Balance Display -->
          <div class="balance-display hidden md:block">
            <div class="flex items-center gap-2">
              <i class="fas fa-wallet" style="color: var(--primary-green);"></i>
              <span>Earnings:</span>
              <span class="balance-amount" id="balanceDisplay">₹0</span>
            </div>
          </div>
          
          <!-- User Dashboard Button -->
          <a href="/" class="p-2 bg-bg-light border border-border-color rounded-lg hover:border-primary-green transition">
            <i class="fas fa-user" style="color: var(--primary-green);"></i>
          </a>
          
          <!-- Profile Button -->
          <div class="relative">
            <button id="profileBtn" class="p-2 bg-bg-light border border-border-color rounded-lg hover:border-primary-green transition">
              <i class="fas fa-user-tie" style="color: var(--primary-green);"></i>
            </button>
            
            <!-- Profile Dropdown -->
            <div id="profileDropdown" class="profile-dropdown">
              <div class="mb-4 pb-4 border-b border-border-color">
                <div class="font-bold" id="profileName">Reseller</div>
                <div class="text-gray-400 text-sm" id="profileEmail">reseller@example.com</div>
                <div class="flex items-center gap-2 mt-2">
                  <i class="fas fa-wallet" style="color: var(--primary-green);"></i>
                  <span>Earnings:</span>
                  <span class="font-bold" style="color: var(--primary-green);" id="profileBalance">₹0</span>
                </div>
                <div class="flex items-center gap-2 mt-2">
                  <i class="fas fa-percentage" style="color: var(--primary-green);"></i>
                  <span>Commission:</span>
                  <span class="font-bold" style="color: var(--primary-green);" id="profileCommission">0%</span>
                </div>
              </div>
              
              <div class="space-y-2">
                <button onclick="refreshDashboard()" class="w-full p-2 bg-bg-light border border-border-color rounded hover:border-primary-green transition flex items-center gap-2">
                  <i class="fas fa-sync-alt" style="color: var(--primary-green);"></i>
                  Refresh Dashboard
                </button>
                
                <button onclick="openWithdrawModal()" class="w-full p-2 bg-yellow-900 bg-opacity-30 border border-yellow-700 rounded hover:border-yellow-500 transition flex items-center gap-2">
                  <i class="fas fa-money-bill-wave" style="color: #FFD166;"></i>
                  Withdraw Earnings
                </button>
                
                <a href="/" class="w-full p-2 bg-bg-light border border-border-color rounded hover:border-primary-green transition flex items-center gap-2">
                  <i class="fas fa-shopping-cart" style="color: var(--primary-green);"></i>
                  Buy OTP Numbers
                </a>
                
                <button onclick="logout()" class="w-full p-2 bg-red-900 bg-opacity-30 border border-red-700 rounded hover:border-red-500 transition flex items-center gap-2">
                  <i class="fas fa-sign-out-alt" style="color: #ff0040;"></i>
                  Logout
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
    
    <!-- STATUS MESSAGE -->
    <div id="statusMessage" class="hidden"></div>
    
    <!-- RESELLER STATS -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
      <div class="stat-card">
        <div class="text-2xl font-bold text-green-400" id="totalEarnings">₹0</div>
        <div class="text-sm text-gray-400">Total Earnings</div>
      </div>
      <div class="stat-card">
        <div class="text-2xl font-bold text-green-400" id="totalSales">₹0</div>
        <div class="text-sm text-gray-400">Total Sales</div>
      </div>
      <div class="stat-card">
        <div class="text-2xl font-bold text-green-400" id="referralCount">0</div>
        <div class="text-sm text-gray-400">Referred Users</div>
      </div>
      <div class="stat-card">
        <div class="text-2xl font-bold text-green-400" id="commissionRate">0%</div>
        <div class="text-sm text-gray-400">Commission Rate</div>
      </div>
    </div>
    
    <!-- REFERRAL LINK SECTION -->
    <div class="number-card">
      <h2 class="text-xl font-bold mb-4 flex items-center" style="color: var(--primary-green);">
        <i class="fas fa-link mr-2"></i>
        Your Referral Link
      </h2>
      
      <div class="referral-link-box">
        <div class="flex items-center gap-3 mb-3">
          <i class="fas fa-id-card text-2xl text-green-400"></i>
          <div>
            <div class="font-bold" id="resellerNameDisplay">Your Name</div>
            <div class="text-sm text-gray-400">Reseller ID: <span id="resellerIdDisplay" class="font-mono">RS000000</span></div>
          </div>
        </div>
        
        <div class="mb-4">
          <label class="block text-gray-300 mb-2">Share this link with customers:</label>
          <div class="flex gap-2">
            <input type="text" id="referralLink" class="flex-1 p-3 bg-black border border-border-color rounded-lg text-green-300" readonly>
            <button onclick="copyReferralLink()" class="action-btn copy-btn px-4">
              <i class="fas fa-copy"></i>
              Copy
            </button>
          </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
          <button onclick="shareWhatsApp()" class="action-btn share-btn">
            <i class="fab fa-whatsapp"></i>
            WhatsApp
          </button>
          <button onclick="shareTelegram()" class="action-btn telegram-btn">
            <i class="fab fa-telegram"></i>
            Telegram
          </button>
          <button onclick="openQRCode()" class="action-btn" style="background: linear-gradient(to right, #8B5CF6, #7C3AED); color: white;">
            <i class="fas fa-qrcode"></i>
            QR Code
          </button>
        </div>
      </div>
      
      <div class="mt-4 p-3 bg-gray-800 rounded-lg">
        <p class="text-sm text-gray-300">
          <i class="fas fa-info-circle mr-2 text-green-400"></i>
          When customers use your link, they get your prices. You earn commission on every purchase!
        </p>
      </div>
    </div>
    
    <!-- PRICE COMPARISON -->
    <div class="number-card">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold flex items-center" style="color: var(--primary-green);">
          <i class="fas fa-tags mr-2"></i>
          Price Comparison
        </h2>
        <button onclick="refreshPrices()" class="p-2 bg-bg-light border border-border-color rounded hover:border-primary-green transition">
          <i class="fas fa-sync-alt"></i>
        </button>
      </div>
      
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="table-header">
            <tr>
              <th class="p-3 text-left">Service</th>
              <th class="p-3 text-left">Base Price</th>
              <th class="p-3 text-left">Your Price</th>
              <th class="p-3 text-left">Your Earnings</th>
              <th class="p-3 text-left">Action</th>
            </tr>
          </thead>
          <tbody id="priceTableBody">
            <tr id="noPricesRow">
              <td colspan="5" class="p-8 text-center text-gray-500">
                <i class="fas fa-spinner fa-spin text-3xl mb-2"></i>
                <p>Loading prices...</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <div class="mt-4 p-3 bg-blue-900 bg-opacity-20 border border-blue-700 rounded-lg">
        <p class="text-sm text-blue-300">
          <i class="fas fa-lightbulb mr-2"></i>
          <strong>Tip:</strong> Customers see "Your Price". You earn the difference between Base Price and Your Price.
        </p>
      </div>
    </div>
    
    <!-- RECENT COMMISSIONS -->
    <div class="number-card">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold flex items-center" style="color: var(--primary-green);">
          <i class="fas fa-history mr-2"></i>
          Recent Commissions
        </h2>
        <button onclick="refreshCommissions()" class="p-2 bg-bg-light border border-border-color rounded hover:border-primary-green transition">
          <i class="fas fa-sync-alt"></i>
        </button>
      </div>
      
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="table-header">
            <tr>
              <th class="p-3 text-left">Date</th>
              <th class="p-3 text-left">Customer</th>
              <th class="p-3 text-left">Service</th>
              <th class="p-3 text-left">Amount</th>
              <th class="p-3 text-left">Commission</th>
              <th class="p-3 text-left">Status</th>
            </tr>
          </thead>
          <tbody id="commissionTableBody">
            <tr id="noCommissionsRow">
              <td colspan="6" class="p-8 text-center text-gray-500">
                <i class="fas fa-money-bill-wave text-3xl mb-2"></i>
                <p>No commissions yet. Share your link to start earning!</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- QUICK ACTIONS -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="number-card">
        <h3 class="text-lg font-bold mb-4 flex items-center" style="color: var(--primary-green);">
          <i class="fas fa-rocket mr-2"></i>
          Quick Actions
        </h3>
        <div class="space-y-3">
          <button onclick="openWithdrawModal()" class="w-full action-btn withdraw-btn">
            <i class="fas fa-money-bill-wave mr-2"></i>
            Withdraw Earnings
          </button>
          <a href="/" class="w-full action-btn copy-btn block text-center">
            <i class="fas fa-shopping-cart mr-2"></i>
            Buy OTP Numbers
          </a>
          <button onclick="refreshDashboard()" class="w-full action-btn" style="background: linear-gradient(to right, #00a2ff, #0088cc); color: white;">
            <i class="fas fa-sync-alt mr-2"></i>
            Refresh Dashboard
          </button>
        </div>
      </div>
      
      <div class="number-card">
        <h3 class="text-lg font-bold mb-4 flex items-center" style="color: var(--primary-green);">
          <i class="fas fa-chart-line mr-2"></i>
          Earnings Forecast
        </h3>
        <div class="space-y-4">
          <div>
            <div class="flex justify-between mb-1">
              <span class="text-gray-300">Today's Earnings</span>
              <span class="text-green-400 font-bold" id="todayEarnings">₹0</span>
            </div>
            <div class="w-full bg-gray-700 rounded-full h-2">
              <div id="todayProgress" class="bg-green-500 h-2 rounded-full" style="width: 0%"></div>
            </div>
          </div>
          
          <div>
            <div class="flex justify-between mb-1">
              <span class="text-gray-300">This Month</span>
              <span class="text-green-400 font-bold" id="monthEarnings">₹0</span>
            </div>
            <div class="w-full bg-gray-700 rounded-full h-2">
              <div id="monthProgress" class="bg-green-500 h-2 rounded-full" style="width: 0%"></div>
            </div>
          </div>
          
          <div class="p-3 bg-gray-800 rounded-lg">
            <p class="text-sm text-gray-300">
              <i class="fas fa-bullhorn mr-2 text-yellow-400"></i>
              Share your link on social media to increase earnings!
            </p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- TIPS & GUIDES -->
    <div class="number-card">
      <h3 class="text-lg font-bold mb-4 flex items-center" style="color: var(--primary-green);">
        <i class="fas fa-graduation-cap mr-2"></i>
        How to Maximize Earnings
      </h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="p-4 bg-gray-800 rounded-lg">
          <div class="flex items-center gap-3 mb-3">
            <div class="w-8 h-8 bg-green-900 rounded-full flex items-center justify-center">
              <span class="text-green-400 font-bold">1</span>
            </div>
            <h4 class="font-bold text-gray-300">Share on WhatsApp Groups</h4>
          </div>
          <p class="text-gray-400 text-sm">Join relevant WhatsApp groups and share your referral link with a compelling message.</p>
        </div>
        
        <div class="p-4 bg-gray-800 rounded-lg">
          <div class="flex items-center gap-3 mb-3">
            <div class="w-8 h-8 bg-green-900 rounded-full flex items-center justify-center">
              <span class="text-green-400 font-bold">2</span>
            </div>
            <h4 class="font-bold text-gray-300">Create Telegram Channel</h4>
          </div>
          <p class="text-gray-400 text-sm">Create a Telegram channel for OTP services and promote your link to subscribers.</p>
        </div>
        
        <div class="p-4 bg-gray-800 rounded-lg">
          <div class="flex items-center gap-3 mb-3">
            <div class="w-8 h-8 bg-green-900 rounded-full flex items-center justify-center">
              <span class="text-green-400 font-bold">3</span>
            </div>
            <h4 class="font-bold text-gray-300">Offer Support</h4>
          </div>
          <p class="text-gray-400 text-sm">Provide customer support to your referrals. Happy customers buy more!</p>
        </div>
        
        <div class="p-4 bg-gray-800 rounded-lg">
          <div class="flex items-center gap-3 mb-3">
            <div class="w-8 h-8 bg-green-900 rounded-full flex items-center justify-center">
              <span class="text-green-400 font-bold">4</span>
            </div>
            <h4 class="font-bold text-gray-300">Use Social Media</h4>
          </div>
          <p class="text-gray-400 text-sm">Share on Facebook, Twitter, Instagram with relevant hashtags like #OTP #WhatsAppVerification.</p>
        </div>
      </div>
    </div>
    
  </div>
  
  <!-- JavaScript -->
  <script>
    // ========== FIREBASE CONFIGURATION ==========
    const firebaseConfig = {
      apiKey: "AIzaSyArJqR7qRvDqz76kc4y6Wpa4Zu2JCcTQgA",
      authDomain: "royal-5b527.firebaseapp.com",
      databaseURL: "https://royal-5b527-default-rtdb.firebaseio.com",
      projectId: "royal-5b527",
      storageBucket: "royal-5b527.firebasestorage.app",
      messagingSenderId: "693286904326",
      appId: "1:693286904326:web:9ae26226c4e92942b85987",
      measurementId: "G-6M7EGTPQPX"
    };

    try {
      firebase.initializeApp(firebaseConfig);
      console.log('Firebase initialized successfully');
    } catch (error) {
      console.error('Firebase initialization error:', error);
    }

    const auth = firebase.auth();
    const database = firebase.database();
    auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);

    // ========== GLOBAL VARIABLES ==========
    let currentUser = null;
    let resellerData = null;
    let referralLink = "";

    // ========== DOM ELEMENTS ==========
    const authModal = document.getElementById('authModal');
    const loginEmail = document.getElementById('loginEmail');
    const loginPassword = document.getElementById('loginPassword');
    const authLoginBtn = document.getElementById('authLoginBtn');
    const authStatus = document.getElementById('authStatus');
    const profileBtn = document.getElementById('profileBtn');
    const profileDropdown = document.getElementById('profileDropdown');
    const profileName = document.getElementById('profileName');
    const profileEmail = document.getElementById('profileEmail');
    const profileBalance = document.getElementById('profileBalance');
    const profileCommission = document.getElementById('profileCommission');
    const balanceDisplay = document.getElementById('balanceDisplay');
    const statusMessage = document.getElementById('statusMessage');
    const becomeResellerModal = document.getElementById('becomeResellerModal');
    const withdrawModal = document.getElementById('withdrawModal');
    const withdrawBalance = document.getElementById('withdrawBalance');
    const withdrawAmount = document.getElementById('withdrawAmount');
    const paymentMethod = document.getElementById('paymentMethod');
    const paymentDetails = document.getElementById('paymentDetails');
    
    // Stats elements
    const totalEarnings = document.getElementById('totalEarnings');
    const totalSales = document.getElementById('totalSales');
    const referralCount = document.getElementById('referralCount');
    const commissionRate = document.getElementById('commissionRate');
    const resellerNameDisplay = document.getElementById('resellerNameDisplay');
    const resellerIdDisplay = document.getElementById('resellerIdDisplay');
    const referralLinkInput = document.getElementById('referralLink');
    const priceTableBody = document.getElementById('priceTableBody');
    const noPricesRow = document.getElementById('noPricesRow');
    const commissionTableBody = document.getElementById('commissionTableBody');
    const noCommissionsRow = document.getElementById('noCommissionsRow');
    const todayEarnings = document.getElementById('todayEarnings');
    const monthEarnings = document.getElementById('monthEarnings');
    const todayProgress = document.getElementById('todayProgress');
    const monthProgress = document.getElementById('monthProgress');

    // ========== AUTH FUNCTIONS ==========
    async function signIn() {
      const email = loginEmail.value.trim();
      const password = loginPassword.value;
      
      if (!email || !password) {
        showAuthStatus('Please enter email and password', 'error');
        return;
      }
      
      try {
        authLoginBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Logging in...';
        authLoginBtn.disabled = true;
        
        await auth.signInWithEmailAndPassword(email, password);
        showAuthStatus('Login successful!', 'success');
        
      } catch (error) {
        console.error('Login error:', error);
        showAuthStatus(getFirebaseError(error), 'error');
        
        authLoginBtn.innerHTML = '<i class="fas fa-sign-in-alt mr-2"></i> LOGIN';
        authLoginBtn.disabled = false;
      }
    }

    function getFirebaseError(error) {
      const msg = error.message || '';
      if (msg.includes('auth/wrong-password')) return 'Wrong password';
      if (msg.includes('auth/user-not-found')) return 'User not found';
      return error.message || 'Authentication failed';
    }

    function showAuthStatus(message, type) {
      authStatus.textContent = message;
      authStatus.className = 'mt-4 p-3 rounded-lg';
      authStatus.classList.add(type === 'success' ? 'status-success' : 'status-error');
      authStatus.classList.remove('hidden');
    }

    function logout() {
      auth.signOut();
      profileDropdown.classList.remove('show');
    }

    // ========== RESELLER FUNCTIONS ==========
    async function checkResellerStatus() {
      if (!currentUser) return;
      
      try {
        const snapshot = await database.ref('users/' + currentUser.uid).once('value');
        const userData = snapshot.val();
        
        if (userData && userData.resellerId) {
          // User is a reseller, load data
          await loadResellerData(userData.resellerId);
        } else {
          // Not a reseller, show become reseller modal
          setTimeout(() => {
            openBecomeResellerModal();
          }, 1000);
        }
      } catch (error) {
        console.error('Check reseller status error:', error);
      }
    }

    async function loadResellerData(resellerId) {
      try {
        const snapshot = await database.ref('resellers/' + resellerId).once('value');
        resellerData = snapshot.val();
        
        if (resellerData) {
          // Update UI
          profileName.textContent = resellerData.name || 'Reseller';
          profileEmail.textContent = currentUser.email;
          profileBalance.textContent = `₹${resellerData.wallet || 0}`;
          profileCommission.textContent = `${resellerData.commissionPercent || 0}%`;
          balanceDisplay.textContent = `₹${resellerData.wallet || 0}`;
          
          resellerNameDisplay.textContent = resellerData.name || 'Your Name';
          resellerIdDisplay.textContent = resellerId;
          
          // Update stats
          totalEarnings.textContent = `₹${resellerData.totalCommission || 0}`;
          totalSales.textContent = `₹${resellerData.totalSales || 0}`;
          referralCount.textContent = resellerData.referralCount || 0;
          commissionRate.textContent = `${resellerData.commissionPercent || 0}%`;
          
          // Generate referral link
          const baseUrl = window.location.origin;
          referralLink = `${baseUrl}/?ref=${resellerId}`;
          referralLinkInput.value = referralLink;
          
          // Hide auth modal
          authModal.style.display = 'none';
          
          // Load additional data
          await loadPriceComparison();
          await loadRecentCommissions();
          await loadEarningsForecast();
        }
      } catch (error) {
        console.error('Load reseller data error:', error);
      }
    }

    async function registerAsReseller() {
      const name = document.getElementById('resellerName').value.trim();
      const commission = document.getElementById('commissionRate').value;
      
      if (!name) {
        showStatus('Please enter your name', 'error');
        return;
      }
      
      try {
        const token = await currentUser.getIdToken();
        
        const response = await fetch('/api/reseller/register', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({
            name: name,
            commissionPercent: parseInt(commission)
          })
        });
        
        const data = await response.json();
        
        if (data.success) {
          showStatus('Reseller account created successfully!', 'success');
          closeBecomeResellerModal();
          await checkResellerStatus();
        } else {
          showStatus('Error: ' + data.error, 'error');
        }
      } catch (error) {
        console.error('Register reseller error:', error);
        showStatus('Network error. Please try again.', 'error');
      }
    }

    // ========== DASHBOARD FUNCTIONS ==========
    async function loadPriceComparison() {
      try {
        if (!resellerData) return;
        
        const response = await fetch(`/api/reseller/prices?ref=${resellerData.id}`);
        const data = await response.json();
        
        if (data.success) {
          noPricesRow.style.display = 'none';
          
          let html = '';
          Object.values(data.prices).forEach(service => {
            html += `
              <tr class="table-row">
                <td class="p-3">
                  <div class="flex items-center gap-2">
                    <span>${service.flag}</span>
                    <div>
                      <div class="font-medium">${service.name}</div>
                      <div class="text-sm text-gray-400">${service.country}</div>
                    </div>
                  </div>
                </td>
                <td class="p-3">
                  <div class="text-gray-400 line-through">₹${service.basePrice}</div>
                </td>
                <td class="p-3">
                  <div class="text-2xl font-bold text-green-400">₹${service.finalPrice}</div>
                </td>
                <td class="p-3">
                  <div class="font-bold text-yellow-400">₹${service.commission}</div>
                  <div class="text-xs text-gray-400">per sale</div>
                </td>
                <td class="p-3">
                  <button onclick="copyServiceLink('${service.name}', ${service.finalPrice})" 
                    class="px-3 py-1 bg-green-900 text-green-300 rounded text-sm hover:bg-green-800">
                    <i class="fas fa-copy mr-1"></i>Copy Link
                  </button>
                </td>
              </tr>
            `;
          });
          
          priceTableBody.innerHTML = html;
        }
      } catch (error) {
        console.error('Load price comparison error:', error);
      }
    }

    async function loadRecentCommissions() {
      try {
        if (!currentUser || !resellerData) return;
        
        // Get user's purchase history to find commissions
        const snapshot = await database.ref('userHistory/' + currentUser.uid)
          .orderByChild('timestamp')
          .limitToLast(10)
          .once('value');
        
        const history = snapshot.val() || {};
        const historyArray = Object.values(history).sort((a, b) => b.timestamp - a.timestamp);
        
        if (historyArray.length > 0) {
          noCommissionsRow.style.display = 'none';
          
          let html = '';
          historyArray.forEach(trans => {
            if (trans.commission && trans.commission > 0) {
              const date = new Date(trans.timestamp);
              const timeStr = date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
              
              html += `
                <tr class="table-row">
                  <td class="p-3 text-gray-400">${timeStr}</td>
                  <td class="p-3">
                    <div class="flex items-center gap-2">
                      <i class="fas fa-user text-green-400"></i>
                      <span>Customer</span>
                    </div>
                  </td>
                  <td class="p-3">${trans.service}</td>
                  <td class="p-3 font-bold">₹${trans.price}</td>
                  <td class="p-3 font-bold text-yellow-400">₹${trans.commission}</td>
                  <td class="p-3">
                    <span class="px-2 py-1 bg-green-900 text-green-300 rounded text-xs">
                      Completed
                    </span>
                  </td>
                </tr>
              `;
            }
          });
          
          if (html) {
            commissionTableBody.innerHTML = html;
          }
        }
      } catch (error) {
        console.error('Load recent commissions error:', error);
      }
    }

    async function loadEarningsForecast() {
      try {
        if (!resellerData) return;
        
        // Simple forecast - you can enhance this
        const today = new Date();
        const todayStr = today.toISOString().split('T')[0];
        
        // Calculate today's earnings (simplified)
        const todayEarningsValue = Math.round((resellerData.totalCommission || 0) / 30);
        const monthEarningsValue = resellerData.totalCommission || 0;
        
        todayEarnings.textContent = `₹${todayEarningsValue}`;
        monthEarnings.textContent = `₹${monthEarningsValue}`;
        
        // Update progress bars
        const todayPercent = Math.min(todayEarningsValue / 1000 * 100, 100);
        const monthPercent = Math.min(monthEarningsValue / 5000 * 100, 100);
        
        todayProgress.style.width = `${todayPercent}%`;
        monthProgress.style.width = `${monthPercent}%`;
      } catch (error) {
        console.error('Load earnings forecast error:', error);
      }
    }

    // ========== SHARE FUNCTIONS ==========
    function copyReferralLink() {
      navigator.clipboard.writeText(referralLinkInput.value).then(() => {
        showStatus('Referral link copied to clipboard!', 'success');
      });
    }

    function copyServiceLink(serviceName, price) {
      const message = `Get ${serviceName} for only ₹${price}! Use my referral link: ${referralLink}`;
      navigator.clipboard.writeText(message).then(() => {
        showStatus(`Link for ${serviceName} copied!`, 'success');
      });
    }

    function shareWhatsApp() {
      const message = `Get OTP numbers for WhatsApp, Telegram, and more at great prices! Use my referral link: ${referralLink}`;
      window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
    }

    function shareTelegram() {
      const message = `Get OTP numbers for WhatsApp, Telegram, and more at great prices! Use my referral link: ${referralLink}`;
      window.open(`https://t.me/share/url?url=${encodeURIComponent(referralLink)}&text=${encodeURIComponent(message)}`, '_blank');
    }

    function openQRCode() {
      const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(referralLink)}`;
      window.open(qrUrl, '_blank');
    }

    // ========== WITHDRAWAL FUNCTIONS ==========
    function openWithdrawModal() {
      if (!resellerData) return;
      
      withdrawBalance.textContent = `₹${resellerData.wallet || 0}`;
      withdrawModal.classList.add('show');
      profileDropdown.classList.remove('show');
    }

    function closeWithdrawModal() {
      withdrawModal.classList.remove('show');
    }

    async function submitWithdrawal() {
      const amount = parseFloat(withdrawAmount.value);
      const method = paymentMethod.value;
      const details = paymentDetails.value.trim();
      
      if (!amount || amount < 100) {
        showStatus('Minimum withdrawal amount is ₹100', 'error');
        return;
      }
      
      if (amount > (resellerData.wallet || 0)) {
        showStatus('Insufficient balance', 'error');
        return;
      }
      
      if (!details) {
        showStatus('Please enter payment details', 'error');
        return;
      }
      
      try {
        // Save withdrawal request
        const withdrawalRef = database.ref('withdrawals').push();
        await withdrawalRef.set({
          resellerId: resellerData.id,
          resellerName: resellerData.name,
          resellerEmail: currentUser.email,
          amount: amount,
          method: method,
          details: details,
          status: 'pending',
          timestamp: Date.now(),
          processed: false
        });
        
        // Update reseller wallet
        const newBalance = (resellerData.wallet || 0) - amount;
        await database.ref('resellers/' + resellerData.id + '/wallet').set(newBalance);
        
        showStatus(`Withdrawal request of ₹${amount} submitted successfully!`, 'success');
        closeWithdrawModal();
        
        // Refresh data
        await loadResellerData(resellerData.id);
        
      } catch (error) {
        console.error('Submit withdrawal error:', error);
        showStatus('Failed to submit withdrawal request', 'error');
      }
    }

    // ========== MODAL FUNCTIONS ==========
    function openBecomeResellerModal() {
      becomeResellerModal.classList.add('show');
    }

    function closeBecomeResellerModal() {
      becomeResellerModal.classList.remove('show');
    }

    // ========== UTILITY FUNCTIONS ==========
    function refreshDashboard() {
      if (resellerData) {
        loadResellerData(resellerData.id);
        showStatus('Dashboard refreshed', 'info');
      }
    }

    function refreshPrices() {
      loadPriceComparison();
      showStatus('Prices refreshed', 'info');
    }

    function refreshCommissions() {
      loadRecentCommissions();
      showStatus('Commissions refreshed', 'info');
    }

    function showStatus(message, type) {
      statusMessage.textContent = message;
      statusMessage.className = '';
      
      if (type === 'success') {
        statusMessage.style.background = 'rgba(0, 255, 157, 0.2)';
        statusMessage.style.color = '#00ff9d';
        statusMessage.style.border = '1px solid #00ff9d';
      } else if (type === 'error') {
        statusMessage.style.background = 'rgba(255, 0, 64, 0.2)';
        statusMessage.style.color = '#ff0040';
        statusMessage.style.border = '1px solid #ff0040';
      } else if (type === 'info') {
        statusMessage.style.background = 'rgba(0, 162, 255, 0.2)';
        statusMessage.style.color = '#00a2ff';
        statusMessage.style.border = '1px solid #00a2ff';
      }
      
      statusMessage.classList.remove('hidden');
      statusMessage.classList.add('p-3', 'rounded-lg', 'mb-4');
      
      setTimeout(() => {
        statusMessage.classList.add('hidden');
      }, 3000);
    }

    // ========== FIREBASE AUTH LISTENER ==========
    auth.onAuthStateChanged(async (user) => {
      if (user) {
        currentUser = user;
        await checkResellerStatus();
      } else {
        currentUser = null;
        resellerData = null;
        authModal.style.display = 'flex';
      }
    });

    // ========== EVENT LISTENERS ==========
    document.addEventListener('DOMContentLoaded', () => {
      authLoginBtn.addEventListener('click', signIn);
      
      profileBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        profileDropdown.classList.toggle('show');
      });
      
      document.addEventListener('click', (e) => {
        if (!e.target.closest('#profileBtn')) {
          profileDropdown.classList.remove('show');
        }
        if (!e.target.closest('.modal-content') && !e.target.closest('.action-btn')) {
          becomeResellerModal.classList.remove('show');
          withdrawModal.classList.remove('show');
        }
      });
      
      // Auto-focus email field
      if (loginEmail) loginEmail.focus();
    });
  </script>
</body>
</html>
