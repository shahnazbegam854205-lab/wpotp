<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Become a Reseller - Happy OTP</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  
  <style>
    :root {
      --primary-green: #00ff99;
      --dark-green: #008b45;
      --bg-dark: #0a0a0a;
      --bg-light: #121212;
    }
    
    body {
      background-color: var(--bg-dark);
      color: white;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-height: 100vh;
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #0a0a0a 0%, #004d26 100%);
    }
    
    .glow-text {
      text-shadow: 0 0 10px var(--primary-green);
    }
    
    .card {
      background: var(--bg-light);
      border: 1px solid #004d26;
      border-radius: 12px;
    }
    
    .status-success {
      background: rgba(0, 255, 157, 0.2);
      color: #00ff9d;
      border: 1px solid #00ff9d;
      border-radius: 8px;
      padding: 12px;
    }
    
    .status-error {
      background: rgba(255, 0, 64, 0.2);
      color: #ff0040;
      border: 1px solid #ff0040;
      border-radius: 8px;
      padding: 12px;
    }
  </style>
</head>
<body class="min-h-screen">
  <!-- Auth Modal -->
  <div id="authModal" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-4 z-50">
    <div class="card p-8 max-w-md w-full">
      <div class="text-center mb-6">
        <i class="fas fa-user-tie text-5xl mb-4" style="color: var(--primary-green);"></i>
        <h2 class="text-2xl font-bold" style="color: var(--primary-green);">RESELLER LOGIN</h2>
        <p class="text-gray-400 mt-2">Login to access reseller panel</p>
      </div>
      
      <div id="loginFields">
        <input type="email" id="loginEmail" class="w-full p-3 mb-3 bg-black border border-green-800 rounded-lg text-white" 
          placeholder="Email Address" value="test@example.com">
        <input type="password" id="loginPassword" class="w-full p-3 mb-4 bg-black border border-green-800 rounded-lg text-white" 
          placeholder="Password" value="password123">
        
        <button id="authLoginBtn" class="w-full p-3 mb-3 bg-gradient-to-r from-green-600 to-green-800 text-white font-bold rounded-lg hover:opacity-90 transition">
          <i class="fas fa-sign-in-alt mr-2"></i>
          LOGIN
        </button>
        
        <div class="text-center mt-4">
          <p class="text-gray-400">
            Don't have an account? 
            <a href="/" class="text-green-400 font-bold hover:underline">
              Register First on Main Site
            </a>
          </p>
          <p class="text-gray-400 text-sm mt-2">
            Already registered? Login with same credentials
          </p>
        </div>
      </div>
      
      <div id="authStatus" class="mt-4 hidden"></div>
    </div>
  </div>

  <!-- Navigation -->
  <nav class="gradient-bg border-b border-green-900 p-4 hidden" id="mainNav">
    <div class="max-w-7xl mx-auto flex justify-between items-center">
      <div class="flex items-center gap-3">
        <i class="fab fa-whatsapp text-3xl text-green-400"></i>
        <h1 class="text-2xl font-bold text-green-400 glow-text">HAPPY OTP RESELLER</h1>
      </div>
      <div class="flex items-center gap-4">
        <span id="userEmail" class="text-gray-300 hidden md:block"></span>
        <button onclick="logout()" class="px-4 py-2 bg-red-900 text-white rounded-lg hover:bg-red-800 transition">
          <i class="fas fa-sign-out-alt mr-2"></i>Logout
        </button>
      </div>
    </div>
  </nav>

  <!-- Main Content (Hidden until login) -->
  <div id="mainContent" class="max-w-7xl mx-auto p-4 space-y-8 hidden">
    <!-- Hero Section -->
    <div class="card p-8 text-center">
      <h2 class="text-3xl font-bold text-green-400 mb-4">Welcome, <span id="welcomeName">Reseller</span>!</h2>
      <p class="text-xl text-gray-300 mb-6">Your reseller dashboard is ready. Start earning commissions today!</p>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="p-6 bg-green-900 bg-opacity-20 rounded-lg">
          <i class="fas fa-money-bill-wave text-4xl text-green-400 mb-4"></i>
          <h3 class="text-xl font-bold mb-2">Earn Commission</h3>
          <p class="text-gray-300">Set your own commission rate (5-30%)</p>
        </div>
        
        <div class="p-6 bg-green-900 bg-opacity-20 rounded-lg">
          <i class="fas fa-link text-4xl text-green-400 mb-4"></i>
          <h3 class="text-xl font-bold mb-2">Unique Referral Link</h3>
          <p class="text-gray-300">Get your personal link to share</p>
        </div>
        
        <div class="p-6 bg-green-900 bg-opacity-20 rounded-lg">
          <i class="fas fa-wallet text-4xl text-green-400 mb-4"></i>
          <h3 class="text-xl font-bold mb-2">Instant Payouts</h3>
          <p class="text-gray-300">Commission added to your wallet instantly</p>
        </div>
      </div>
    </div>

    <!-- Registration Form -->
    <div class="card p-8">
      <h3 class="text-2xl font-bold text-green-400 mb-6">Become a Reseller</h3>
      
      <div id="registerForm">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
          <div>
            <label class="block text-gray-300 mb-2">Your Name</label>
            <input type="text" id="resellerName" 
              class="w-full p-3 bg-black border border-green-800 rounded-lg text-white"
              placeholder="Enter your name">
          </div>
          
          <div>
            <label class="block text-gray-300 mb-2">Commission Rate (%)</label>
            <select id="commissionPercent" 
              class="w-full p-3 bg-black border border-green-800 rounded-lg text-white">
              <option value="5">5% Commission (Recommended)</option>
              <option value="10" selected>10% Commission</option>
              <option value="15">15% Commission</option>
              <option value="20">20% Commission</option>
              <option value="25">25% Commission</option>
              <option value="30">30% Commission (Maximum)</option>
            </select>
            <p class="text-sm text-gray-400 mt-2">Higher commission = Higher price for your customers</p>
          </div>
        </div>
        
        <button onclick="registerReseller()" 
          class="w-full p-4 bg-gradient-to-r from-green-600 to-green-800 text-white font-bold rounded-lg hover:opacity-90 transition">
          <i class="fas fa-user-tie mr-2"></i>BECOME A RESELLER
        </button>
      </div>
      
      <!-- Reseller Dashboard (Hidden initially) -->
      <div id="resellerDashboard" class="hidden">
        <div class="bg-green-900 bg-opacity-20 border border-green-700 rounded-lg p-6 mb-6">
          <div class="flex items-center gap-3 mb-4">
            <i class="fas fa-check-circle text-3xl text-green-400"></i>
            <h4 class="text-xl font-bold text-green-300">Reseller Account Active!</h4>
          </div>
          
          <div class="space-y-4">
            <div>
              <label class="block text-gray-300 mb-1">Your Reseller ID:</label>
              <div class="flex gap-2">
                <input type="text" id="resellerIdDisplay" 
                  class="flex-1 p-3 bg-black border border-green-800 rounded-lg text-green-300 font-mono" readonly>
                <button onclick="copyResellerId()" 
                  class="px-4 bg-green-700 text-white rounded-lg hover:bg-green-600">
                  <i class="fas fa-copy"></i>
                </button>
              </div>
            </div>
            
            <div>
              <label class="block text-gray-300 mb-1">Your Referral Link:</label>
              <div class="flex gap-2">
                <input type="text" id="referralLink" 
                  class="flex-1 p-3 bg-black border border-green-800 rounded-lg text-green-300" readonly>
                <button onclick="copyReferralLink()" 
                  class="px-4 bg-green-700 text-white rounded-lg hover:bg-green-600">
                  <i class="fas fa-copy"></i>
                </button>
              </div>
            </div>
            
            <div>
              <label class="block text-gray-300 mb-1">Commission Rate:</label>
              <div class="p-3 bg-black border border-green-800 rounded-lg">
                <span id="commissionDisplay" class="text-2xl font-bold text-green-400">10%</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
          <div class="card p-4 text-center">
            <div class="text-3xl font-bold text-green-400" id="walletAmount">₹0</div>
            <div class="text-gray-400">Wallet Balance</div>
          </div>
          
          <div class="card p-4 text-center">
            <div class="text-3xl font-bold text-green-400" id="totalSales">₹0</div>
            <div class="text-gray-400">Total Sales</div>
          </div>
          
          <div class="card p-4 text-center">
            <div class="text-3xl font-bold text-green-400" id="totalCommission">₹0</div>
            <div class="text-gray-400">Total Commission</div>
          </div>
          
          <div class="card p-4 text-center">
            <div class="text-3xl font-bold text-green-400" id="referralCount">0</div>
            <div class="text-gray-400">Referred Users</div>
          </div>
        </div>
        
        <!-- Share Links -->
        <div class="card p-6 mb-6">
          <h4 class="text-xl font-bold text-green-400 mb-4">Share Your Link</h4>
          <div class="flex flex-wrap gap-3">
            <button onclick="shareWhatsApp()" class="px-4 py-2 bg-green-900 text-white rounded-lg hover:bg-green-800">
              <i class="fab fa-whatsapp mr-2"></i>Share on WhatsApp
            </button>
            <button onclick="shareTelegram()" class="px-4 py-2 bg-blue-900 text-white rounded-lg hover:bg-blue-800">
              <i class="fab fa-telegram mr-2"></i>Share on Telegram
            </button>
            <button onclick="copyToClipboard()" class="px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-700">
              <i class="fas fa-link mr-2"></i>Copy Link
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- FAQ -->
    <div class="card p-8">
      <h3 class="text-2xl font-bold text-green-400 mb-6">FAQ</h3>
      <div class="space-y-4">
        <div>
          <h4 class="text-lg font-bold text-gray-300">How much can I earn?</h4>
          <p class="text-gray-400">With 10% commission, if you refer 10 customers who each buy ₹1000 worth of OTP numbers, you earn ₹1000!</p>
        </div>
        
        <div>
          <h4 class="text-lg font-bold text-gray-300">When do I get paid?</h4>
          <p class="text-gray-400">Commission is added to your wallet instantly when your referral makes a purchase.</p>
        </div>
        
        <div>
          <h4 class="text-lg font-bold text-gray-300">How do I withdraw money?</h4>
          <p class="text-gray-400">Contact admin on WhatsApp to withdraw your wallet balance to UPI/Bank.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Status Message -->
  <div id="statusMessage" class="fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 hidden"></div>

  <script>
    // ========== FIREBASE CONFIGURATION ==========
    const firebaseConfig = {
      apiKey: "AIzaSyArJqR7qRvDqz76kc4y6Wpa4Zu2JCcTQgA",
      authDomain: "royal-5b527.firebaseapp.com",
      databaseURL: "https://royal-5b527-default-rtdb.firebaseio.com",
      projectId: "royal-5b527",
      storageBucket: "royal-5b527.firebasestorage.app",
      messagingSenderId: "693286904326",
      appId: "1:693286904326:web:9ae26226c4e92942b85987",
      measurementId: "G-6M7EGTPQPX"
    };

    // Initialize Firebase
    let auth, database;
    try {
      firebase.initializeApp(firebaseConfig);
      auth = firebase.auth();
      database = firebase.database();
      auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);
      console.log('Firebase initialized successfully');
    } catch (error) {
      console.error('Firebase initialization error:', error);
      showStatus('Firebase initialization failed. Please refresh page.', 'error');
    }

    // ========== DOM ELEMENTS ==========
    const authModal = document.getElementById('authModal');
    const mainNav = document.getElementById('mainNav');
    const mainContent = document.getElementById('mainContent');
    const loginEmail = document.getElementById('loginEmail');
    const loginPassword = document.getElementById('loginPassword');
    const authLoginBtn = document.getElementById('authLoginBtn');
    const authStatus = document.getElementById('authStatus');
    const userEmail = document.getElementById('userEmail');
    const welcomeName = document.getElementById('welcomeName');
    const registerForm = document.getElementById('registerForm');
    const resellerDashboard = document.getElementById('resellerDashboard');
    const statusMessage = document.getElementById('statusMessage');

    // ========== AUTH FUNCTIONS ==========
    async function signIn() {
      const email = loginEmail.value.trim();
      const password = loginPassword.value;
      
      if (!email || !password) {
        showAuthStatus('Please enter email and password', 'error');
        return;
      }
      
      try {
        authLoginBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Logging in...';
        authLoginBtn.disabled = true;
        
        // Try to sign in
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        console.log('Login successful:', userCredential.user.email);
        
        // Show success and hide auth modal
        showAuthStatus('Login successful! Loading dashboard...', 'success');
        
        // Hide auth modal after delay
        setTimeout(() => {
          authModal.style.display = 'none';
          mainNav.classList.remove('hidden');
          mainContent.classList.remove('hidden');
          userEmail.textContent = email;
          welcomeName.textContent = email.split('@')[0];
          
          // Check reseller status
          checkResellerStatus(userCredential.user);
        }, 1500);
        
      } catch (error) {
        console.error('Login error:', error);
        let errorMsg = 'Login failed';
        
        if (error.code === 'auth/wrong-password') {
          errorMsg = 'Wrong password';
        } else if (error.code === 'auth/user-not-found') {
          errorMsg = 'User not found. Please register first on main site.';
        } else if (error.code === 'auth/invalid-email') {
          errorMsg = 'Invalid email address';
        } else {
          errorMsg = error.message;
        }
        
        showAuthStatus(errorMsg, 'error');
        authLoginBtn.innerHTML = '<i class="fas fa-sign-in-alt mr-2"></i> LOGIN';
        authLoginBtn.disabled = false;
      }
    }

    function showAuthStatus(message, type) {
      authStatus.textContent = message;
      authStatus.className = 'mt-4 p-3 rounded-lg';
      
      if (type === 'success') {
        authStatus.classList.add('status-success');
        authStatus.classList.remove('status-error');
      } else {
        authStatus.classList.add('status-error');
        authStatus.classList.remove('status-success');
      }
      
      authStatus.classList.remove('hidden');
      
      setTimeout(() => {
        authStatus.classList.add('hidden');
      }, 3000);
    }

    function showStatus(message, type) {
      statusMessage.textContent = message;
      statusMessage.className = 'fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50';
      
      if (type === 'success') {
        statusMessage.style.background = 'rgba(0, 255, 157, 0.2)';
        statusMessage.style.color = '#00ff9d';
        statusMessage.style.border = '1px solid #00ff9d';
      } else if (type === 'error') {
        statusMessage.style.background = 'rgba(255, 0, 64, 0.2)';
        statusMessage.style.color = '#ff0040';
        statusMessage.style.border = '1px solid #ff0040';
      } else {
        statusMessage.style.background = 'rgba(0, 162, 255, 0.2)';
        statusMessage.style.color = '#00a2ff';
        statusMessage.style.border = '1px solid #00a2ff';
      }
      
      statusMessage.classList.remove('hidden');
      
      setTimeout(() => {
        statusMessage.classList.add('hidden');
      }, 3000);
    }

    function logout() {
      auth.signOut();
      location.reload();
    }

    // ========== RESELLER FUNCTIONS ==========
    async function checkResellerStatus(user) {
      try {
        const userRef = database.ref('users/' + user.uid);
        const snapshot = await userRef.once('value');
        const userData = snapshot.val();
        
        if (userData && userData.resellerId) {
          // User is already a reseller
          showStatus('Loading reseller dashboard...', 'info');
          loadResellerDashboard(userData.resellerId);
        } else {
          // Not a reseller, show registration form
          showStatus('You are not a reseller yet. Register below.', 'info');
          registerForm.classList.remove('hidden');
          resellerDashboard.classList.add('hidden');
        }
      } catch (error) {
        console.error('Check reseller status error:', error);
        showStatus('Error checking reseller status', 'error');
      }
    }

    async function loadResellerDashboard(resellerId) {
      try {
        const resellerRef = database.ref('resellers/' + resellerId);
        const snapshot = await resellerRef.once('value');
        const resellerData = snapshot.val();
        
        if (resellerData) {
          // Hide registration form, show dashboard
          registerForm.classList.add('hidden');
          resellerDashboard.classList.remove('hidden');
          
          // Update dashboard data
          document.getElementById('resellerIdDisplay').value = resellerId;
          document.getElementById('commissionDisplay').textContent = `${resellerData.commissionPercent || 10}%`;
          document.getElementById('walletAmount').textContent = `₹${resellerData.wallet || 0}`;
          document.getElementById('totalSales').textContent = `₹${resellerData.totalSales || 0}`;
          document.getElementById('totalCommission').textContent = `₹${resellerData.totalCommission || 0}`;
          document.getElementById('referralCount').textContent = resellerData.referralCount || 0;
          
          // Generate referral link
          const baseUrl = window.location.origin;
          const referralLink = `${baseUrl}/?ref=${resellerId}`;
          document.getElementById('referralLink').value = referralLink;
          
          showStatus('Reseller dashboard loaded!', 'success');
        }
      } catch (error) {
        console.error('Load reseller dashboard error:', error);
        showStatus('Error loading reseller data', 'error');
      }
    }

    async function registerReseller() {
      const name = document.getElementById('resellerName').value.trim();
      const commissionPercent = document.getElementById('commissionPercent').value;
      
      if (!name) {
        showStatus('Please enter your name', 'error');
        return;
      }
      
      const user = auth.currentUser;
      if (!user) {
        showStatus('Please login first', 'error');
        return;
      }
      
      try {
        showStatus('Creating reseller account...', 'info');
        
        // Get Firebase token
        const token = await user.getIdToken();
        
        // Call API to create reseller
        const response = await fetch('/api/reseller/register', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({
            name: name,
            commissionPercent: parseInt(commissionPercent)
          })
        });
        
        const data = await response.json();
        
        if (data.success) {
          showStatus('Reseller account created successfully!', 'success');
          
          // Reload dashboard
          setTimeout(() => {
            checkResellerStatus(user);
          }, 1000);
          
        } else {
          showStatus('Error: ' + data.error, 'error');
        }
      } catch (error) {
        console.error('Register reseller error:', error);
        showStatus('Network error. Please try again.', 'error');
      }
    }

    // ========== SHARE FUNCTIONS ==========
    function copyResellerId() {
      const resellerId = document.getElementById('resellerIdDisplay').value;
      navigator.clipboard.writeText(resellerId);
      showStatus('Reseller ID copied!', 'success');
    }

    function copyReferralLink() {
      const link = document.getElementById('referralLink').value;
      navigator.clipboard.writeText(link);
      showStatus('Referral link copied!', 'success');
    }

    function copyToClipboard() {
      const link = document.getElementById('referralLink').value;
      navigator.clipboard.writeText(link);
      showStatus('Link copied to clipboard! Share it with your customers.', 'success');
    }

    function shareWhatsApp() {
      const link = document.getElementById('referralLink').value;
      const message = `Get OTP numbers for WhatsApp, Telegram, and more! Use my referral link: ${link}`;
      window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
    }

    function shareTelegram() {
      const link = document.getElementById('referralLink').value;
      const message = `Get OTP numbers for WhatsApp, Telegram, and more! Use my referral link: ${link}`;
      window.open(`https://t.me/share/url?url=${encodeURIComponent(link)}&text=${encodeURIComponent(message)}`, '_blank');
    }

    // ========== EVENT LISTENERS ==========
    document.addEventListener('DOMContentLoaded', () => {
      // Check if already logged in
      auth.onAuthStateChanged((user) => {
        if (user) {
          console.log('Already logged in:', user.email);
          authModal.style.display = 'none';
          mainNav.classList.remove('hidden');
          mainContent.classList.remove('hidden');
          userEmail.textContent = user.email;
          welcomeName.textContent = user.email.split('@')[0];
          checkResellerStatus(user);
        } else {
          console.log('Not logged in');
          authModal.style.display = 'flex';
        }
      });
      
      // Login button
      authLoginBtn.addEventListener('click', signIn);
      
      // Enter key to login
      loginPassword.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          signIn();
        }
      });
    });
  </script>
</body>
</html>
