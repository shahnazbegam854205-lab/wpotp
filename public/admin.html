<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyber Admin - Royal Services</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', 'Segoe UI', monospace;
        }

        :root {
            --neon-green: #00ff00;
            --dark-green: #00cc00;
            --matrix-green: #0f0;
            --cyber-blue: #00ffff;
            --dark-bg: #0a0a0a;
            --darker-bg: #050505;
            --panel-bg: #111111;
            --text-glow: 0 0 10px var(--neon-green), 0 0 20px var(--neon-green);
            --box-glow: 0 0 15px rgba(0, 255, 0, 0.3);
            --cyber-red: #ff0033;
        }

        body {
            background: var(--dark-bg);
            color: var(--neon-green);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Matrix Background Effect */
        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.1;
            background: linear-gradient(rgba(0, 255, 0, 0.1) 1px, transparent 1px),
                        linear-gradient(90deg, rgba(0, 255, 0, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
        }

        /* Login Container */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }

        .cyber-border {
            position: relative;
            padding: 3px;
            background: linear-gradient(45deg, var(--neon-green), var(--cyber-blue), var(--neon-green));
            border-radius: 5px;
            animation: borderGlow 2s linear infinite;
        }

        @keyframes borderGlow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .login-box {
            background: var(--darker-bg);
            padding: 40px;
            width: 100%;
            max-width: 400px;
            border-radius: 3px;
            position: relative;
        }

        .cyber-grid {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, transparent 49%, rgba(0, 255, 0, 0.1) 50%, transparent 51%),
                linear-gradient(transparent 49%, rgba(0, 255, 0, 0.1) 50%, transparent 51%);
            background-size: 20px 20px;
            pointer-events: none;
            z-index: 1;
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
            z-index: 2;
        }

        .login-header h1 {
            color: var(--neon-green);
            font-size: 28px;
            text-transform: uppercase;
            letter-spacing: 3px;
            text-shadow: var(--text-glow);
            margin-bottom: 10px;
        }

        .login-header p {
            color: var(--cyber-blue);
            font-size: 12px;
            letter-spacing: 2px;
        }

        .input-group {
            margin-bottom: 25px;
            position: relative;
            z-index: 2;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--cyber-blue);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .cyber-input {
            width: 100%;
            padding: 12px 15px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid var(--neon-green);
            border-radius: 2px;
            color: var(--neon-green);
            font-size: 16px;
            font-family: 'Courier New', monospace;
            transition: all 0.3s;
            box-shadow: inset 0 0 10px rgba(0, 255, 0, 0.1);
        }

        .cyber-input:focus {
            outline: none;
            border-color: var(--cyber-blue);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
        }

        .cyber-input::placeholder {
            color: rgba(0, 255, 0, 0.5);
        }

        .cyber-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(45deg, var(--dark-green), var(--neon-green));
            border: none;
            border-radius: 2px;
            color: #000;
            font-size: 16px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            z-index: 2;
        }

        .cyber-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 255, 0, 0.5);
            background: linear-gradient(45deg, var(--neon-green), var(--cyber-blue));
        }

        .cyber-btn:active {
            transform: translateY(0);
        }

        .error-message {
            color: var(--cyber-red);
            font-size: 14px;
            margin-top: 15px;
            text-align: center;
            padding: 10px;
            background: rgba(255, 0, 51, 0.1);
            border: 1px solid var(--cyber-red);
            border-radius: 2px;
            display: none;
            text-shadow: 0 0 10px rgba(255, 0, 51, 0.5);
            position: relative;
            z-index: 2;
        }

        /* Admin Dashboard */
        .admin-container {
            display: none;
            min-height: 100vh;
        }

        /* Header */
        .cyber-header {
            background: linear-gradient(to bottom, rgba(0, 255, 0, 0.1), transparent);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--neon-green);
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
            position: relative;
        }

        .cyber-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--neon-green), transparent);
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .cyber-logo {
            width: 40px;
            height: 40px;
            background: var(--neon-green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-weight: bold;
            font-size: 20px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 10px var(--neon-green); }
            50% { box-shadow: 0 0 20px var(--neon-green); }
        }

        .header-title h1 {
            color: var(--neon-green);
            font-size: 24px;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: var(--text-glow);
        }

        .header-title .subtitle {
            color: var(--cyber-blue);
            font-size: 12px;
            letter-spacing: 1px;
            margin-top: 5px;
        }

        .admin-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-terminal {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid var(--neon-green);
            padding: 8px 15px;
            border-radius: 2px;
            min-width: 200px;
        }

        .terminal-line {
            color: var(--neon-green);
            font-size: 12px;
            font-family: 'Courier New', monospace;
        }

        .terminal-line::before {
            content: '> ';
            color: var(--cyber-blue);
        }

        .cyber-logout {
            background: linear-gradient(45deg, var(--cyber-red), #ff3366);
            color: #000;
            border: none;
            padding: 8px 15px;
            border-radius: 2px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .cyber-logout:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 0, 51, 0.5);
        }

        /* Main Content */
        .cyber-content {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Stats Grid - Cyber Style */
        .cyber-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-terminal {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid var(--neon-green);
            border-radius: 3px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }

        .stat-terminal:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 255, 0, 0.3);
            border-color: var(--cyber-blue);
        }

        .terminal-header {
            color: var(--cyber-blue);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .terminal-header::before {
            content: '■';
            color: var(--neon-green);
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        .stat-value {
            font-size: 36px;
            font-weight: bold;
            color: var(--neon-green);
            text-shadow: var(--text-glow);
            margin-bottom: 10px;
        }

        .stat-label {
            color: rgba(0, 255, 0, 0.7);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Table Section */
        .cyber-table-section {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid var(--neon-green);
            border-radius: 3px;
            padding: 25px;
            box-shadow: var(--box-glow);
        }

        .section-terminal {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 255, 0, 0.3);
        }

        .section-terminal h2 {
            color: var(--neon-green);
            font-size: 18px;
            text-transform: uppercase;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-terminal h2::before {
            content: '▸';
            color: var(--cyber-blue);
        }

        .cyber-search {
            display: flex;
            gap: 10px;
        }

        .search-terminal {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid var(--neon-green);
            color: var(--neon-green);
            padding: 10px 15px;
            border-radius: 2px;
            min-width: 300px;
            font-family: 'Courier New', monospace;
        }

        .cyber-button {
            background: linear-gradient(45deg, var(--dark-green), var(--neon-green));
            border: none;
            color: #000;
            padding: 10px 20px;
            border-radius: 2px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .cyber-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 0, 0.5);
        }

        /* Cyber Table */
        .table-terminal {
            overflow-x: auto;
            border: 1px solid rgba(0, 255, 0, 0.3);
            border-radius: 2px;
        }

        .cyber-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1000px;
        }

        .cyber-table thead {
            background: rgba(0, 255, 0, 0.1);
        }

        .cyber-table th {
            padding: 15px;
            text-align: left;
            color: var(--cyber-blue);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid var(--neon-green);
            position: relative;
        }

        .cyber-table th::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--neon-green), transparent);
        }

        .cyber-table td {
            padding: 15px;
            border-bottom: 1px solid rgba(0, 255, 0, 0.1);
            color: rgba(0, 255, 0, 0.9);
            font-family: 'Courier New', monospace;
        }

        .cyber-table tr:hover {
            background: rgba(0, 255, 0, 0.05);
        }

        .api-key {
            font-family: 'Courier New', monospace;
            color: var(--cyber-blue);
            background: rgba(0, 255, 255, 0.1);
            padding: 2px 5px;
            border-radius: 2px;
            font-size: 11px;
        }

        .balance-amount {
            color: var(--neon-green);
            font-weight: bold;
            text-shadow: 0 0 5px rgba(0, 255, 0, 0.5);
        }

        .action-button {
            background: linear-gradient(45deg, var(--dark-green), var(--neon-green));
            border: none;
            color: #000;
            padding: 8px 15px;
            border-radius: 2px;
            cursor: pointer;
            font-weight: bold;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 255, 0, 0.3);
        }

        /* Modal */
        .cyber-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-terminal {
            background: var(--darker-bg);
            border: 1px solid var(--neon-green);
            border-radius: 3px;
            width: 100%;
            max-width: 500px;
            padding: 30px;
            position: relative;
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.5);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 255, 0, 0.3);
        }

        .modal-header h3 {
            color: var(--neon-green);
            font-size: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-terminal {
            background: none;
            border: none;
            color: var(--cyber-red);
            font-size: 24px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .close-terminal:hover {
            background: rgba(255, 0, 51, 0.1);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--cyber-blue);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid var(--neon-green);
            border-radius: 2px;
            color: var(--neon-green);
            font-family: 'Courier New', monospace;
        }

        .form-control:read-only {
            opacity: 0.7;
            cursor: not-allowed;
        }

        /* Loader */
        .cyber-loader {
            text-align: center;
            padding: 40px;
        }

        .loader-terminal {
            display: inline-block;
            padding: 20px;
            border: 1px solid var(--neon-green);
            border-radius: 3px;
            background: rgba(0, 0, 0, 0.8);
        }

        .loader-text {
            color: var(--neon-green);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 15px;
        }

        .loader-animation {
            width: 50px;
            height: 50px;
            border: 3px solid transparent;
            border-top: 3px solid var(--neon-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-terminal {
            text-align: center;
            padding: 40px;
            border: 1px solid rgba(0, 255, 0, 0.3);
            border-radius: 3px;
            margin-top: 20px;
        }

        .empty-icon {
            font-size: 48px;
            color: rgba(0, 255, 0, 0.3);
            margin-bottom: 15px;
        }

        .empty-text {
            color: rgba(0, 255, 0, 0.7);
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .cyber-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .section-terminal {
                flex-direction: column;
                align-items: stretch;
            }
            
            .cyber-search {
                width: 100%;
            }
            
            .search-terminal {
                min-width: 0;
                width: 100%;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
</head>
<body>
    <!-- Matrix Background -->
    <div class="matrix-bg"></div>

    <!-- Login Form -->
    <div id="loginForm" class="login-container">
        <div class="cyber-border">
            <div class="login-box">
                <div class="cyber-grid"></div>
                <div class="login-header">
                    <h1><i class="fas fa-terminal"></i> CYBER ADMIN</h1>
                    <p>ACCESS CONTROL SYSTEM v2.0</p>
                </div>
                
                <div class="input-group">
                    <label><i class="fas fa-user-secret"></i> ADMIN ID</label>
                    <input type="email" id="email" class="cyber-input" placeholder="root@admin.system" required>
                </div>
                
                <div class="input-group">
                    <label><i class="fas fa-key"></i> ACCESS KEY</label>
                    <input type="password" id="password" class="cyber-input" placeholder="••••••••" required>
                </div>
                
                <button class="cyber-btn" onclick="login()">
                    <i class="fas fa-sign-in-alt"></i> INITIATE ACCESS
                </button>
                
                <div id="loginError" class="error-message"></div>
                <div id="loginLoader" class="cyber-loader" style="display: none;">
                    <div class="loader-terminal">
                        <div class="loader-text">AUTHENTICATING</div>
                        <div class="loader-animation"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="admin-container">
        <!-- Header -->
        <div class="cyber-header">
            <div class="header-title">
                <div class="cyber-logo">RS</div>
                <div>
                    <h1>ROYAL SERVICES</h1>
                    <div class="subtitle">ADMINISTRATION TERMINAL</div>
                </div>
            </div>
            
            <div class="admin-info">
                <div class="user-terminal">
                    <div class="terminal-line" id="adminName">USER: SYSTEM_ADMIN</div>
                    <div class="terminal-line" id="adminEmail">STATUS: ONLINE</div>
                    <div class="terminal-line">SESSION: ACTIVE</div>
                </div>
                <button class="cyber-logout" onclick="logout()">
                    <i class="fas fa-power-off"></i> LOGOUT
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="cyber-content">
            <!-- Statistics -->
            <div class="cyber-stats">
                <div class="stat-terminal">
                    <div class="terminal-header">TOTAL USERS</div>
                    <div class="stat-value" id="totalUsers">0</div>
                    <div class="stat-label">ACTIVE ACCOUNTS</div>
                </div>
                
                <div class="stat-terminal">
                    <div class="terminal-header">TOTAL BALANCE</div>
                    <div class="stat-value" id="totalBalance">₹0</div>
                    <div class="stat-label">SYSTEM WALLET</div>
                </div>
                
                <div class="stat-terminal">
                    <div class="terminal-header">TOTAL SPENT</div>
                    <div class="stat-value" id="totalSpent">₹0</div>
                    <div class="stat-label">REVENUE GENERATED</div>
                </div>
                
                <div class="stat-terminal">
                    <div class="terminal-header">API REQUESTS</div>
                    <div class="stat-value" id="totalRequests">0</div>
                    <div class="stat-label">TOTAL REQUESTS</div>
                </div>
            </div>

            <!-- Users Table -->
            <div class="cyber-table-section">
                <div class="section-terminal">
                    <h2><i class="fas fa-server"></i> USER MANAGEMENT SYSTEM</h2>
                    <div class="cyber-search">
                        <input type="text" class="search-terminal" id="searchUser" 
                               placeholder="SEARCH: EMAIL | NAME | UID" onkeyup="searchUsers()">
                        <button class="cyber-button" onclick="loadUsers()">
                            <i class="fas fa-sync-alt"></i> REFRESH
                        </button>
                    </div>
                </div>

                <div class="table-terminal">
                    <table class="cyber-table" id="usersTable">
                        <thead>
                            <tr>
                                <th><i class="fas fa-id-card"></i> USER ID</th>
                                <th><i class="fas fa-user"></i> NAME</th>
                                <th><i class="fas fa-envelope"></i> EMAIL</th>
                                <th><i class="fas fa-wallet"></i> BALANCE</th>
                                <th><i class="fas fa-calendar"></i> JOINED</th>
                                <th><i class="fas fa-key"></i> API KEY</th>
                                <th><i class="fas fa-code"></i> REQUESTS</th>
                                <th><i class="fas fa-rupee-sign"></i> SPENT</th>
                                <th><i class="fas fa-cogs"></i> ACTIONS</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- Users will be loaded here -->
                        </tbody>
                    </table>
                </div>

                <div id="tableLoader" class="cyber-loader" style="display: none;">
                    <div class="loader-terminal">
                        <div class="loader-text">LOADING USER DATA</div>
                        <div class="loader-animation"></div>
                    </div>
                </div>
                
                <div id="noUsers" class="empty-terminal" style="display: none;">
                    <div class="empty-icon">
                        <i class="fas fa-users-slash"></i>
                    </div>
                    <div class="empty-text">NO USERS FOUND</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Balance Modal -->
    <div id="addBalanceModal" class="cyber-modal">
        <div class="modal-terminal">
            <div class="modal-header">
                <h3><i class="fas fa-coins"></i> BALANCE TRANSFER</h3>
                <button class="close-terminal" onclick="closeModal('addBalanceModal')">&times;</button>
            </div>
            
            <div class="form-group">
                <label class="form-label"><i class="fas fa-user-tag"></i> TARGET USER</label>
                <input type="text" id="userInfo" class="form-control" readonly>
            </div>
            
            <div class="form-group">
                <label class="form-label"><i class="fas fa-wallet"></i> CURRENT BALANCE</label>
                <input type="text" id="currentBalance" class="form-control" readonly>
            </div>
            
            <div class="form-group">
                <label class="form-label"><i class="fas fa-plus-circle"></i> TRANSFER AMOUNT (₹)</label>
                <input type="number" id="amount" class="form-control" placeholder="ENTER AMOUNT" min="1" required>
            </div>
            
            <div class="form-group">
                <label class="form-label"><i class="fas fa-sticky-note"></i> TRANSACTION NOTE</label>
                <input type="text" id="reason" class="form-control" placeholder="E.G.: BONUS, REFUND, ETC.">
            </div>
            
            <button class="cyber-button" style="width: 100%; margin-top: 20px;" onclick="addBalance()">
                <i class="fas fa-paper-plane"></i> EXECUTE TRANSFER
            </button>
            
            <div id="balanceError" class="error-message" style="margin-top: 15px;"></div>
        </div>
    </div>

    <script>
        // Firebase Configuration
const firebaseConfig = {
    apiKey: "AIzaSyArJqR7qRvDqz76kc4y6Wpa4Zu2JCcTQgA",
    authDomain: "royal-5b527.firebaseapp.com",
    databaseURL: "https://royal-5b527-default-rtdb.firebaseio.com",
    projectId: "royal-5b527",
    storageBucket: "royal-5b527.firebasestorage.app",
    messagingSenderId: "693286904326",
    appId: "1:693286904326:web:9ae26226c4e92942b85987",
    measurementId: "G-6M7EGTPQPX"
};

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        // Backend API URL
        const API_BASE = 'https://happyotp-51ic.vercel.app';

        // Global variables
        let currentUser = null;
        let firebaseToken = null;
        let allUsers = [];
        let currentUserForBalance = null;

        // Check if user is already logged in
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                firebaseToken = await user.getIdToken();
                
                // Check if user is admin
                const isAdmin = await checkIfAdmin(user.uid);
                if (isAdmin) {
                    showAdminDashboard();
                    loadUsers();
                } else {
                    showError('ACCESS DENIED: ADMINISTRATOR PRIVILEGES REQUIRED');
                    await auth.signOut();
                }
            } else {
                showLoginForm();
            }
        });

        // Check if user is admin
        async function checkIfAdmin(uid) {
            const ADMIN_UID = 'qJMfK4Hi3abMVOQxNrqWGZ4sUTx2';
            
            try {
                // You can create a simple admin check endpoint in your backend
                const response = await fetch(`${API_BASE}/api/admin/check?uid=${uid}`, {
                    headers: {
                        'Authorization': `Bearer ${firebaseToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    return data.isAdmin || uid === ADMIN_UID;
                }
            } catch (error) {
                console.log('Admin check failed:', error);
            }
            
            // Fallback: Check against main admin UID
            return uid === ADMIN_UID;
        }

        // Login function
        async function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('loginError');
            const loader = document.getElementById('loginLoader');
            
            errorDiv.style.display = 'none';
            
            if (!email || !password) {
                showError('ERROR: CREDENTIALS REQUIRED');
                return;
            }
            
            loader.style.display = 'block';
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (error) {
                console.error('Login error:', error);
                showError(`AUTH FAILURE: ${error.message}`);
                loader.style.display = 'none';
            }
        }

        // Logout function
        async function logout() {
            if (confirm('TERMINATE ADMIN SESSION?')) {
                await auth.signOut();
                currentUser = null;
                firebaseToken = null;
                allUsers = [];
            }
        }

        // Show login form
        function showLoginForm() {
            document.getElementById('loginForm').style.display = 'flex';
            document.getElementById('adminDashboard').style.display = 'none';
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
        }

        // Show admin dashboard
        function showAdminDashboard() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'block';
            
            // Update admin info
            if (currentUser) {
                document.getElementById('adminName').textContent = 
                    `USER: ${currentUser.displayName?.toUpperCase() || 'SYSTEM_ADMIN'}`;
                document.getElementById('adminEmail').textContent = 
                    `EMAIL: ${currentUser.email || 'NO_EMAIL'}`;
            }
        }

        // Show error message
        function showError(message) {
            const errorDiv = document.getElementById('loginError');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        // Load users from backend
        async function loadUsers() {
            if (!firebaseToken) {
                showError('ERROR: NOT AUTHENTICATED');
                return;
            }
            
            const loader = document.getElementById('tableLoader');
            const tableBody = document.getElementById('usersTableBody');
            const noUsers = document.getElementById('noUsers');
            
            loader.style.display = 'block';
            tableBody.innerHTML = '';
            noUsers.style.display = 'none';
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/getUsers`, {
                    headers: {
                        'Authorization': `Bearer ${firebaseToken}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status} - ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    allUsers = data.users || [];
                    displayUsers(allUsers);
                    updateStats(allUsers);
                } else {
                    throw new Error(data.error || 'FAILED TO LOAD USER DATA');
                }
                
            } catch (error) {
                console.error('Error loading users:', error);
                showError(`DATA LOAD ERROR: ${error.message}`);
                noUsers.style.display = 'block';
            } finally {
                loader.style.display = 'none';
            }
        }

        // Display users in table
        function displayUsers(users) {
            const tableBody = document.getElementById('usersTableBody');
            const noUsers = document.getElementById('noUsers');
            
            tableBody.innerHTML = '';
            
            if (users.length === 0) {
                noUsers.style.display = 'block';
                return;
            }
            
            noUsers.style.display = 'none';
            
            users.forEach(user => {
                const row = document.createElement('tr');
                
                // Format date
                const joinDate = new Date(user.joined);
                const formattedDate = joinDate.toLocaleDateString('en-IN', {
                    day: '2-digit',
                    month: 'short',
                    year: 'numeric'
                });
                
                // Shorten UID for display
                const shortUid = user.uid ? user.uid.substring(0, 8) + '...' : 'N/A';
                
                row.innerHTML = `
                    <td><code>${shortUid}</code></td>
                    <td>${user.name || 'N/A'}</td>
                    <td>${user.email || 'NO EMAIL'}</td>
                    <td><span class="balance-amount">₹${user.wallet || 0}</span></td>
                    <td>${formattedDate}</td>
                    <td><span class="api-key" title="${user.apiKey || 'NO KEY'}">${(user.apiKey || 'NO_KEY').substring(0, 10)}...</span></td>
                    <td>${user.apiRequests || 0}</td>
                    <td>₹${user.totalSpent || 0}</td>
                    <td>
                        <button class="action-button" onclick="openAddBalanceModal('${user.uid}', '${user.name}', ${user.wallet || 0})">
                            <i class="fas fa-plus"></i> ADD BALANCE
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // Update statistics
        function updateStats(users) {
            const totalUsers = users.length;
            const totalBalance = users.reduce((sum, user) => sum + (user.wallet || 0), 0);
            const totalSpent = users.reduce((sum, user) => sum + (user.totalSpent || 0), 0);
            const totalRequests = users.reduce((sum, user) => sum + (user.apiRequests || 0), 0);
            
            document.getElementById('totalUsers').textContent = totalUsers;
            document.getElementById('totalBalance').textContent = `₹${totalBalance}`;
            document.getElementById('totalSpent').textContent = `₹${totalSpent}`;
            document.getElementById('totalRequests').textContent = totalRequests;
        }

        // Search users
        function searchUsers() {
            const searchTerm = document.getElementById('searchUser').value.toLowerCase();
            const tableBody = document.getElementById('usersTableBody');
            const noUsers = document.getElementById('noUsers');
            
            if (!searchTerm) {
                displayUsers(allUsers);
                return;
            }
            
            const filteredUsers = allUsers.filter(user => 
                (user.email && user.email.toLowerCase().includes(searchTerm)) ||
                (user.name && user.name.toLowerCase().includes(searchTerm)) ||
                (user.uid && user.uid.toLowerCase().includes(searchTerm))
            );
            
            if (filteredUsers.length === 0) {
                tableBody.innerHTML = '';
                noUsers.style.display = 'block';
            } else {
                displayUsers(filteredUsers);
            }
        }

        // Open add balance modal
        function openAddBalanceModal(userId, userName, currentBalance) {
            currentUserForBalance = { userId, userName, currentBalance };
            
            document.getElementById('userInfo').value = `${userName} (${userId.substring(0, 8)}...)`;
            document.getElementById('currentBalance').value = `₹${currentBalance}`;
            document.getElementById('amount').value = '';
            document.getElementById('reason').value = '';
            document.getElementById('balanceError').textContent = '';
            
            document.getElementById('addBalanceModal').style.display = 'flex';
        }

        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            currentUserForBalance = null;
        }

        // Add balance to user
        async function addBalance() {
            if (!currentUserForBalance || !firebaseToken) {
                alert('ERROR: SESSION EXPIRED. PLEASE RE-LOGIN.');
                return;
            }
            
            const amount = document.getElementById('amount').value;
            const reason = document.getElementById('reason').value;
            const errorDiv = document.getElementById('balanceError');
            
            errorDiv.textContent = '';
            
            if (!amount || isNaN(amount) || parseFloat(amount) <= 0) {
                errorDiv.textContent = 'ERROR: INVALID AMOUNT SPECIFIED';
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/addBalance`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${firebaseToken}`
                    },
                    body: JSON.stringify({
                        userId: currentUserForBalance.userId,
                        amount: parseFloat(amount),
                        reason: reason || 'ADMIN BALANCE TRANSFER'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert(`SUCCESS: ₹${amount} TRANSFERRED TO ${currentUserForBalance.userName}`);
                    closeModal('addBalanceModal');
                    loadUsers(); // Refresh the user list
                } else {
                    throw new Error(data.error || 'TRANSFER FAILED');
                }
                
            } catch (error) {
                console.error('Error adding balance:', error);
                errorDiv.textContent = `TRANSFER ERROR: ${error.message}`;
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('cyber-modal')) {
                closeModal('addBalanceModal');
            }
        };

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            // Refresh with F5 or Ctrl+R
            if (event.key === 'F5' || (event.ctrlKey && event.key === 'r')) {
                event.preventDefault();
                loadUsers();
            }
            
            // Search focus with Ctrl+F
            if (event.ctrlKey && event.key === 'f') {
                event.preventDefault();
                document.getElementById('searchUser').focus();
            }
            
            // Escape to close modal
            if (event.key === 'Escape') {
                closeModal('addBalanceModal');
            }
            
            // Logout with Ctrl+L
            if (event.ctrlKey && event.key === 'l') {
                event.preventDefault();
                logout();
            }
        });

        // Auto focus on email field
        document.getElementById('email').focus();
        
        // Add some terminal-like typing effect
        setTimeout(() => {
            const emailField = document.getElementById('email');
            if (emailField && !emailField.value) {
                emailField.placeholder = "ENTER ADMIN CREDENTIALS";
            }
        }, 1000);
    </script>
</body>
</html>