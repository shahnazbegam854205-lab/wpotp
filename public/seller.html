<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Become Seller - Happy OTP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0a0a0a; color: white; font-family: 'Poppins', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #0a0a0a 0%, #004d26 100%); }
        .green-glow { box-shadow: 0 0 20px rgba(0, 255, 153, 0.3); }
        .green-border { border: 2px solid #00ff99; }
    </style>
</head>
<body class="gradient-bg min-h-screen flex items-center justify-center p-4">
    <div class="max-w-lg w-full">
        <a href="/" class="inline-flex items-center text-green-400 hover:text-green-300 mb-6">
            <i class="fas fa-arrow-left mr-2"></i> Back to Main Site
        </a>

        <div class="bg-gray-900 green-border rounded-xl p-6 green-glow">
            <div id="loginRequired" class="mb-6">
                <div class="text-center mb-6">
                    <i class="fas fa-store text-5xl text-green-400 mb-4"></i>
                    <h1 class="text-3xl font-bold text-green-400">Become a Seller</h1>
                    <p class="text-gray-400 mt-2">Create your own OTP website & earn commission</p>
                </div>
                
                <div class="p-4 bg-yellow-900/30 border border-yellow-700 rounded-lg">
                    <i class="fas fa-info-circle text-yellow-400 mr-2"></i>
                    <span class="text-yellow-300">Login with your Happy OTP account first</span>
                    <button onclick="window.location.href='/?ref=seller'" 
                            class="mt-3 w-full py-3 bg-green-600 text-black font-bold rounded-lg hover:bg-green-700">
                        <i class="fas fa-sign-in-alt mr-2"></i>Go to Login Page
                    </button>
                </div>
            </div>

            <div id="sellerForm" class="hidden">
                <div class="text-center mb-6">
                    <i class="fas fa-crown text-5xl text-green-400 mb-4"></i>
                    <h1 class="text-3xl font-bold text-green-400">Create Your Shop</h1>
                    <p class="text-gray-400 mt-2">Fill details below</p>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-300 mb-2">
                            <i class="fas fa-store mr-2"></i>Your Shop Name
                        </label>
                        <input type="text" id="shopName" 
                               class="w-full p-3 bg-black green-border text-white rounded-lg"
                               placeholder="e.g., Rajesh OTP Shop"
                               oninput="updatePreview()">
                        <p class="text-sm text-gray-500 mt-1">This will appear in your website header</p>
                    </div>

                    <div>
                        <label class="block text-gray-300 mb-2">
                            <i class="fas fa-money-bill-wave mr-2"></i>Commission Per Sale (₹)
                        </label>
                        <div class="grid grid-cols-5 gap-2 mb-3">
                            <button onclick="setCommission(5)" class="py-2 bg-gray-800 border border-gray-700 rounded hover:border-green-500">₹5</button>
                            <button onclick="setCommission(10)" class="py-2 bg-gray-800 border border-gray-700 rounded hover:border-green-500">₹10</button>
                            <button onclick="setCommission(15)" class="py-2 bg-gray-800 border border-gray-700 rounded hover:border-green-500 bg-green-900">₹15</button>
                            <button onclick="setCommission(20)" class="py-2 bg-gray-800 border border-gray-700 rounded hover:border-green-500">₹20</button>
                            <button onclick="setCommission(25)" class="py-2 bg-gray-800 border border-gray-700 rounded hover:border-green-500">₹25</button>
                        </div>
                        <input type="range" id="commissionRange" min="5" max="50" value="15" 
                               class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-green-500"
                               oninput="updateCommission(this.value)">
                        <div class="flex justify-between text-sm text-gray-400 mt-1">
                            <span>₹5</span>
                            <span id="currentCommission" class="text-green-400 font-bold">₹15</span>
                            <span>₹50</span>
                        </div>
                    </div>

                    <div class="p-4 bg-gray-800/50 border border-gray-700 rounded-lg">
                        <h3 class="font-bold text-green-400 mb-3">
                            <i class="fas fa-eye mr-2"></i>Live Preview
                        </h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span>Your Shop:</span>
                                <span class="font-bold" id="previewShop">Rajesh OTP Shop</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Commission Per Sale:</span>
                                <span class="text-green-400 font-bold" id="previewCommission">₹15</span>
                            </div>
                            <div class="flex justify-between border-t border-gray-700 pt-2">
                                <span class="font-bold">Customer Pays:</span>
                                <span class="text-yellow-400 font-bold">₹50 + ₹15 = <span id="previewTotal">₹65</span></span>
                            </div>
                        </div>
                    </div>

                    <button onclick="registerSeller()" 
                            class="w-full py-4 mt-4 bg-gradient-to-r from-green-500 to-green-700 text-black font-bold text-lg rounded-lg hover:opacity-90 transition">
                        <i class="fas fa-rocket mr-2"></i>CREATE MY SELLER WEBSITE
                    </button>
                </div>
            </div>
        </div>

        <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="bg-gray-900 border border-green-500/30 p-4 rounded-lg text-center">
                <i class="fas fa-globe text-2xl text-green-400 mb-2"></i>
                <h3 class="font-bold text-green-400">Your Website</h3>
                <p class="text-xs text-gray-400 mt-1">wpotp.vercel.app/seller-page.html?seller=your-shop</p>
            </div>
            <div class="bg-gray-900 border border-green-500/30 p-4 rounded-lg text-center">
                <i class="fas fa-wallet text-2xl text-green-400 mb-2"></i>
                <h3 class="font-bold text-green-400">Instant Earnings</h3>
                <p class="text-xs text-gray-400 mt-1">Commission on every sale</p>
            </div>
            <div class="bg-gray-900 border border-green-500/30 p-4 rounded-lg text-center">
                <i class="fas fa-chart-line text-2xl text-green-400 mb-2"></i>
                <h3 class="font-bold text-green-400">Dashboard</h3>
                <p class="text-xs text-gray-400 mt-1">Track sales & earnings</p>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyArJqR7qRvDqz76kc4y6Wpa4Zu2JCcTQgA",
            authDomain: "royal-5b527.firebaseapp.com",
            databaseURL: "https://royal-5b527-default-rtdb.firebaseio.com",
            projectId: "royal-5b527",
            storageBucket: "royal-5b527.firebasestorage.app",
            messagingSenderId: "693286904326",
            appId: "1:693286904326:web:9ae26226c4e92942b85987"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();

        auth.onAuthStateChanged((user) => {
            if (user) {
                document.getElementById('loginRequired').classList.add('hidden');
                document.getElementById('sellerForm').classList.remove('hidden');
                if (user.email) {
                    const defaultName = user.displayName || user.email.split('@')[0];
                    document.getElementById('shopName').placeholder = `${defaultName}'s OTP Shop`;
                }
            }
        });

        function setCommission(amount) {
            document.getElementById('commissionRange').value = amount;
            updateCommission(amount);
        }

        function updateCommission(value) {
            document.getElementById('currentCommission').textContent = `₹${value}`;
            updatePreview();
        }

        function updatePreview() {
            const shopName = document.getElementById('shopName').value || "Your Shop";
            const commission = document.getElementById('commissionRange').value;
            document.getElementById('previewShop').textContent = shopName;
            document.getElementById('previewCommission').textContent = `₹${commission}`;
            document.getElementById('previewTotal').textContent = `₹${50 + parseInt(commission)}`;
        }

        async function registerSeller() {
            const shopName = document.getElementById('shopName').value.trim();
            const commission = document.getElementById('commissionRange').value;
            
            if (!shopName) {
                alert('Please enter your shop name');
                return;
            }
            
            const user = auth.currentUser;
            if (!user) {
                alert('Please login first');
                window.location.href = '/';
                return;
            }
            
            const token = await user.getIdToken();
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Creating...';
            btn.disabled = true;
            
            try {
                const response = await fetch('/api/seller/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        shopName: shopName,
                        commissionAmount: commission
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert(`✅ Success!\n\nYour seller website:\n${data.sellerUrl}\n\nShare this link with customers to start earning!`);
                    window.location.href = `/seller-dashboard.html?seller=${data.sellerId}`;
                } else {
                    alert('❌ Error: ' + (data.error || 'Failed'));
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }
            } catch (error) {
                alert('Network error: ' + error.message);
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            updatePreview();
        });
    </script>
</body>
</html>
